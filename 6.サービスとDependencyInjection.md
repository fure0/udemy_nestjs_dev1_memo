# Serviceとは

- ビジネスロジックを定義する
- Controllerから呼び出すことで、ユースケースを実現する
- Controllerにビジネスロジックを書いてもプログラムは動作する
- 責務ごとに分割することで、保守性・拡張性などが上がりよい設計となる

# Dependency Injection (DI)

- 日本語にすると「依存性の注入」

```UsersController``` --> ```UsersService```
- UsersControllerはUsersServiceに依存している

##  依存関係のあるオブジェクトを外部から渡す
### コード例

```typescript
@Controller('users')
export class UsersController {
  @Get()
  findAll() {
    const service = new UsersService();
    return service.findAll();
  }
}
```

## 環境ごとのサービスインスタンス

- テスト (Test)
  - `service = new TestUsersService()`

- 本番 (Production)
  - `service = new ProductUsersService()`


```UsersController``` <-- ```UsersService```
- 本番用とテスト用でインスタンスの切り替え
- ログの出力先の切り替え

# Serviceの定義

1. classに@Injectable()デコレーターをつける ※@Service()ではないので注意

```typescript
import { Injectable } from '@nestjs/common';

@Injectable()
export class UsersService {}
```

2. ビジネスロジックを実現するメソッドを作成する

```typescript
@Injectable()
export class UsersService {
  find(userName: number) {
    // Find user
  }
}
```

# ControllerからServiceを利用する

## 1. ModuleのprovidersにServiceを登録する

```typescript
@Module({
  controllers: [UsersController],
  providers: [UsersService],
})
export class UsersModule {}
```

## 2. ControllerのconstructorでServiceを引数に取る

```typescript
@Controller('users')
export class UsersController {
  constructor(private readonly userService: UsersService) {}

  @Get(':username')
  find(@Param('username') userName: string) {
    this.userService.find(userName);
  }
}
```

## サービス作成コマンド
```bash
# nest g service サービス名
nest g service items --no-spec
```
> --no-specは テストを作らないオプション